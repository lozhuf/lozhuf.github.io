<?xml version="1.0" encoding="UTF-8"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content"><channel><title>Mostly Code</title><description>A description of LaurieHufford.com</description><link>https://lauriehufford.com</link><language>en</language><lastBuildDate>Fri, 21 Feb 2020 12:16:55 +0100</lastBuildDate><pubDate>Fri, 21 Feb 2020 12:16:55 +0100</pubDate><ttl>250</ttl><atom:link href="https://lauriehufford.com/feed.rss" rel="self" type="application/rss+xml"/><item><guid isPermaLink="true">https://lauriehufford.com/blog/a-smarter-cfbundleversion</guid><title>A Smarter CFBundleVersion</title><description>A simple and practical solution for managing your app's build version.</description><link>https://lauriehufford.com/blog/a-smarter-cfbundleversion</link><pubDate>Wed, 19 Apr 2017 20:15:00 +0200</pubDate><content:encoded><![CDATA[<p>When initially setting up the project for our iOS app at <a href="https://tjek.com">Tjek</a>, I spent a while trying to find a nice solution for generating the CFBundleVersion number.</p><p>My requirements were:</p><ul><li><strong>Unique</strong>: Every release must have a unique version.</li><li><strong>Ever increasing</strong>: A release's version should be greater than the previous release.</li><li><strong>Automatic</strong> : The value should be dynamically generated.</li></ul><p>Additionally, the resulting value needs to be version-control safe, by which I mean builds on multiple branches can't have the same build version. Most importantly, I didn't want to have to think about it - it should just be a unique identifier for every build out of Xcode.</p><h2>A matter of time</h2><p>I investigated a number of possibilities and suggestions dotted around the internet, including manually updating the value, scripts for auto-incrementing the number, and using branch commit counts, but all seemed to have one or other flaw.</p><p>The solution I finally came to in the end seemed to solve all our needs, and I haven't seen it described elsewhere, so I hope it will be of use to others.</p><p>All you need is to run this short script as a Build Phase:</p><pre><code><span class="type">BUILD_NUMBER</span>=$(date -u <span class="string">"+%y%m%d%H%M"</span>)
<span class="type">INFO_PLIST</span>=<span class="string">"${TARGET_BUILD_DIR}/${INFOPLIST_PATH}"</span>
/usr/libexec/<span class="type">PlistBuddy</span> -c <span class="string">"Set :CFBundleVersion $BUILD_NUMBER" "$INFO_PLIST"</span>
</code></pre><p>This generates a CFBundleVersion of the form <code>201704190842</code>. This may at first glance look like a rather unwieldy build number, but actually encodes a lot of useful information; if you squint your eyes just right it makes a bit more sense: <code>2017-04-19 08:42</code>.</p><img src="https://lauriehufford.com/images/bttf_clock.gif" alt="Back to the Future"/><p>It is unique (for all builds built more than a minute apart), is ever increasing (if you avoid building around DST changes), and mostly human-readable (you can cross-reference the date with source control commits, and also builds in the Xcode Organizer).</p><h2>Possible pitfalls</h2><h3>Time Zones</h3><p>If you have a team in multiple timezones you might end up with collisions if the timezone isnt normalized.</p><p>The above code snippet uses the GMT timezone (via the <code>-u</code> flag), but unfortunately this makes it a bit more complicated to cross-reference exact hours/minutes from the build time for those outside GMT. Usually, though, you would only be comparing at a month/day granularity, so in practice this isn't such a problem.</p><h3>App Extensions</h3><p>As far as I understand it, extensions must have the same build version as the app that contains them. This is a more complicated nut to crack, but one that I believe is crackable (we dont currently have any extensions in our app, so we've avoided this problem so far).</p><hr><p>Despite these possible wrinkles we have been successfully using it in production for the last 3 years. Obviously every project/team is different, so your mileage may vary, but I hope you find this useful too.</p>]]></content:encoded></item></channel></rss>